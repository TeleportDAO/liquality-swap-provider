const { getAxiosInstance } = require('../../utils/tools')

class GetBlock {
  constructor({ token, timeout = 30_000 }, testnet = false) {
    const mainnetUrl = `https://btc.getblock.io/mainnet/blockbook/api`
    const testnetUrl = 'https://btc.getblock.io/testnet/blockbook/api/'
    this.baseURL = testnet ? testnetUrl : mainnetUrl
    this.axios = getAxiosInstance({
      baseUrl: this.baseURL,
      timeout,
      headers: {
        'x-api-key': token,
      },
    })
  }

  async getUtxos(address) {
    const result = await this.axios.get(`/utxo/${address}`)
    const utxos = result.data.map((tx) => ({
      address,
      txId: tx.txid,
      index: tx.vout,
      value: Number(tx.satoshis),
      blockNumber: +tx.height,
    }))
    return utxos
  }
}

module.exports = GetBlock
