const { getAxiosInstance } = require('../../utils/tools')

class NowNodes {
  constructor({ token, timeout = 30_000 }, testnet = false) {
    const mainnetUrl = 'https://btc.nownodes.io/'
    const testnetUrl = 'https://btc-testnet.nownodes.io/'
    this.baseURL = testnet ? testnetUrl : mainnetUrl
    this.axios = getAxiosInstance({
      baseUrl: this.baseURL,
      timeout,
      headers: {
        'api-key': token,
      },
    })
  }

  async getUtxos(address) {
    const result = await this.axios.get(`/api/v2/utxo/${address}`)
    const utxos = result.data.map((tx) => ({
      address,
      txId: tx.txid,
      index: tx.vout,
      value: Number(tx.value),
      blockNumber: +tx.height,
    }))
    return utxos
  }
}

module.exports = NowNodes
