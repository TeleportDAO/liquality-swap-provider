const RPC = require('./rpc')
const ApiProviders = require('./api')

/**
 * @param {String} connectionInfo.url
 * @param {Object} connectionInfo.headers
 * @param {Object} connectionInfo.auth
 */
function getRpcProvider(connectionInfo) {
  const { url, headers, auth } = connectionInfo
  return new RpcProvider({
    url,
    headers,
    auth,
  })
}

/**
 * @param {String} networkName
 * @param {Object} connectionInfo
 * @param {String} connectionInfo.provider
 * @param {String?} connectionInfo.token
 */
function getApiProvider(connectionInfo, networkName) {
  let Provider = ApiProviders[connectionInfo.provider]
  if (!Provider) throw new Error('provider not supported')
  let testnet = networkName.includes('_testnet')
  return new Provider(
    {
      token: connectionInfo.token,
    },
    testnet,
  )
}

module.exports = {
  RPC,
  ApiProviders,
  getRpcProvider,
  getApiProvider,
}
